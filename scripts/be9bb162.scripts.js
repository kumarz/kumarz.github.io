"use strict";var xperiment=angular.module("kumarz.github.ioApp",["ui.router"]);xperiment.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("index",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("synth",{url:"/synth",templateUrl:"views/synth.html",controller:"MainCtrl"})}]),xperiment.run(["$window","keypadService",function(a,b){a.onkeydown=function(a){b.keydown(a)},a.onkeyup=function(a){b.keyup(a)}}]),xperiment.controller("MainCtrl",["$scope","synth",function(a,b){a.synth=b,b.oscillator.type=2}]),xperiment.directive("audioCtrl",["synth",function(a){return{restrict:"A",link:function(b){b.freq=0,b.q=0;var c=document.getElementById("keyboard"),d=(c.querySelectorAll(".key"),document.getElementById("wavetype")),e=document.getElementById("cutoff-freq"),f=document.getElementById("filter-q");d.onchange=function(b){var c=b.target.value;a.oscillator.type=parseInt(c)},e.onchange=function(c){b.freq=a.setFilterFrequency(c.target.value)},f.onchange=function(c){b.q=a.setFilterQ(c.target.value)}}}}]),xperiment.directive("keyboard",["synth","animateKeys","changeBg",function(a,b,c){return{restrict:"A",link:function(d,e){var f=$(e).find(".key");$(f).each(function(){$(this).on("mousedown",function(d){d.stopPropagation();var e=this.dataset.note+5;a.noteOn(e),b(e,d.target),c.changeColor()}),$(this).on("mouseup",function(b){b.stopPropagation(),this.dataset.note+5,a.noteOff()}),$(this).on("mousemove",function(b){b.stopPropagation();var c=document.elementFromPoint(b.x,b.y);if(c.dataset.note){var d=c.dataset.note+parseInt(8*Math.random());a.noteSlide(d)}})})}}}]),xperiment.factory("synth",function(){var a=function(a){this.context=a||new webkitAudioContext,this.notes={C0:16.35,"C#0":17.32,Db0:17.32,D0:18.35,"D#0":19.45,Eb0:19.45,E0:20.6,F0:21.83,"F#0":23.12,Gb0:23.12,G0:24.5,"G#0":25.96,Ab0:25.96,A0:27.5,"A#0":29.14,Bb0:29.14,B0:30.87,C1:32.7,"C#1":34.65,Db1:34.65,D1:36.71,"D#1":38.89,Eb1:38.89,E1:41.2,F1:43.65,"F#1":46.25,Gb1:46.25,G1:49,"G#1":51.91,Ab1:51.91,A1:55,"A#1":58.27,Bb1:58.27,B1:61.74,C2:65.41,"C#2":69.3,Db2:69.3,D2:73.42,"D#2":77.78,Eb2:77.78,E2:82.41,F2:87.31,"F#2":92.5,Gb2:92.5,G2:98,"G#2":103.83,Ab2:103.83,A2:110,"A#2":116.54,Bb2:116.54,B2:123.47,C3:130.81,"C#3":138.59,Db3:138.59,D3:146.83,"D#3":155.56,Eb3:155.56,E3:164.81,F3:174.61,"F#3":185,Gb3:185,G3:196,"G#3":207.65,Ab3:207.65,A3:220,"A#3":233.08,Bb3:233.08,B3:246.94,C4:261.63,"C#4":277.18,Db4:277.18,D4:293.66,"D#4":311.13,Eb4:311.13,E4:329.63,F4:349.23,"F#4":369.99,Gb4:369.99,G4:392,"G#4":415.3,Ab4:415.3,A4:440,"A#4":466.16,Bb4:466.16,B4:493.88,C5:523.25,"C#5":554.37,Db5:554.37,D5:587.33,"D#5":622.25,Eb5:622.25,E5:659.26,F5:698.46,"F#5":739.99,Gb5:739.99,G5:783.99,"G#5":830.61,Ab5:830.61,A5:880,"A#5":932.33,Bb5:932.33,B5:987.77,C6:1046.5,"C#6":1108.73,Db6:1108.73,D6:1174.66,"D#6":1244.51,Eb6:1244.51,E6:1318.51,F6:1396.91,"F#6":1479.98,Gb6:1479.98,G6:1567.98,"G#6":1661.22,Ab6:1661.22,A6:1760,"A#6":1864.66,Bb6:1864.66,B6:1975.53,C7:2093,"C#7":2217.46,Db7:2217.46,D7:2349.32,"D#7":2489.02,Eb7:2489.02,E7:2637.02,F7:2793.83,"F#7":2959.96,Gb7:2959.96,G7:3135.96,"G#7":3322.44,Ab7:3322.44,A7:3520,"A#7":3729.31,Bb7:3729.31,B7:3951.07,C8:4186.01,"C#8":4434.92,Db8:4434.92,D8:4698.64,"D#8":4978.03,Eb8:4978.03},this.frequency=0,this.filterFrequency=0,this.oscillator=this.context.createOscillator(),this.gain=this.context.createGainNode(),this.filter=this.context.createBiquadFilter(),this.filter.type=0,this.portamento=.1,this.gain.gain.value=0,this.oscillator.noteOn(0),this.oscillator.connect(this.filter),this.filter.connect(this.gain),this.gain.connect(this.context.destination)};a.prototype.noteOn=function(a){var b=this.notes[a]||0,c=this.context.currentTime;this.oscillator.frequency.setValueAtTime(b,c),this.gain.gain.setValueAtTime(1,c),console.log("the key f is "+b)},a.prototype.noteOff=function(){var a=this.context.currentTime;this.gain.gain.setValueAtTime(0,a)},a.prototype.noteSlide=function(a){var b=this.context.currentTime,c=this.notes[a]||0;this.oscillator.frequency.linearRampToValueAtTime(c,b+this.portamento)},a.prototype.setFilterFrequency=function(a){var b=this.context.currentTime,c=40,d=this.context.sampleRate/2,e=Math.log(d/c)/Math.LN2,f=Math.pow(2,e*(a-1)),g=d*f;return console.log("the f is "+d*f),this.filter.frequency.setValueAtTime(d*f,b),g},a.prototype.setFilterQ=function(a){var b=this.context.currentTime;return this.filter.Q.setValueAtTime(30*a,b),30*a};var b=new webkitAudioContext,c=new a(b);return c}),xperiment.factory("keypadService",["synth","animateKeys","changeBg",function(a,b,c){var d=function(){this.keymap={65:"C",87:"C#",83:"D",69:"D#",68:"E",72:"F",85:"F#",74:"G",73:"G#",75:"A",79:"A#",76:"B"}};return d.prototype.keydown=function(d){if(d.keyCode in this.keymap){var e=this.keymap[d.keyCode],f=document.querySelector('div[data-note="'+e+'"]');a.noteOn(e+5),b(e,f),c.changeColor()}},d.prototype.keyup=function(){a.noteOff()},new d}]),xperiment.factory("animateKeys",function(){var a=function(a,b){var c=document.createElement("div");c.classList.add("note"),c.innerHTML=a,b.contains(c)||b.appendChild(c),window.setTimeout(function(){b.removeChild(c)},2e3)};return a}),xperiment.factory("changeBg",[function(){var a=function(){this.colors=["#2ecc71","#3498db","#9b59b6","#34495e","#f1c40f","#e67e22","#e74c3c","#f39c12","#ecf0f1"]};return a.prototype.changeColor=function(){document.body.setAttribute("style","background: "+_.sample(this.colors))},new a}]);